<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">

<title>我的成绩单</title>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="assets/css/bootstrap.min.css" />

<!-- Optional theme 
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">-->
<!-- FONTAWESOME STYLE CSS -->
<link href="assets/css/font-awesome.min.css" rel="stylesheet" />
<!-- CUSTOM STYLE CSS -->
<link href="assets/css/style.css" rel="stylesheet" />

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body ng-controller="MainController as main">
	<div class="container-fluid" ng-init="init()">
		<div class="row-fluid">
			<!-- <div class="col-sm-12 main" id="printableArea" ng-include="'assets/templates/grades_template_simple_1.html'"></div> -->
			<div class="col-sm-12 main" id="printableArea">
				<h1 class="page-header">我的成绩单</h1>

				<div class="table-responsive">
					<table class="table table-striped bootstrap-datatable datatable">
						<thead>
							<tr>
							<tr>
								<th>比赛时间</th>
								<th>成绩</th>
								<th>金牌</th>
								<th>银牌</th>
								<th>铜牌</th>
								<th>积分</th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="grade in grades">
								<td>{{formatDate(grade.eventTime) | date:"MM/dd/yyyy,
									HH:mm" }}</td>
								<td>{{grade.score}}</td>
								<td><div ng-class="{1:'medals1'}[grade.rank]"> </div></td>
								<td><div ng-class="{2:'medals2'}[grade.rank]"> </div></td>
								<td><div ng-class="{3:'medals3'}[grade.rank]"> </div></td>
								<td>{{grade.credit}}</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- Bootstrap core JavaScript
    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<!-- ANGULAR -->
	<script src="assets/plugins/angular.js"></script>
	<script src="assets/plugins/angular-resource.js"></script>
	<!-- JAVASCRIPT FILES PLACED AT THE BOTTOM TO REDUCE THE LOADING TIME  -->
	<!-- CORE JQUERY  -->
	<script src="assets/plugins/jquery-1.10.2.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="assets/plugins/bootstrap.js"></script>
	<script>
		var zmxk = angular.module('zmxk', [ 'ngResource' ]);
		zmxk.config([ '$resourceProvider', function($resourceProvider) {
			// Don't strip trailing slashes from calculated URLs
			$resourceProvider.defaults.stripTrailingSlashes = false;
		} ]);

		zmxk
				.controller(
						'MainController',
						[
								'$resource',
								'$scope',
								'$q',
								function($resource, $scope, $q) {
									$scope.gold = "<div class=\"medals\"><img src=\"assets/img/1.png\"></img></div>";
									var userResource = $resource(
											"/service/smartool/api/v1/users/me",
											{},
											{
												getGrades : {
													url : "/service/smartool/api/v1/users/me/grades",
													method : 'GET',
													isArray : true,
													headers : {
														'Content-Type' : 'application/json'
													}
												}
											});

									var getGrades = function() {
										var defer = $q.defer();
										userResource.getGrades(function(e,
												headers) {
											defer.resolve(e);
										}, function(e, headers) {
											defer.reject(e);
										});
										return defer.promise;
									}

									$scope.grades = [];

									$scope.formatDate = function(time) {
										var date = new Date(time);
										var hours = date.getHours();
										var minutes = date.getMinutes();
										var ampm = hours >= 12 ? 'pm' : 'am';
										hours = hours % 12;
										hours = hours ? hours : 12; // the hour '0'
										// should be '12'
										minutes = minutes < 10 ? '0' + minutes
												: minutes;
										var strTime = hours + ':' + minutes
												+ ' ' + ampm;
										return date.getMonth() + 1 + "/"
												+ date.getDate() + "/"
												+ date.getFullYear() + "  "
												+ strTime;
									}

									$scope.init = function() {
										getGrades().then(function(data) {
											$scope.grades = data;
										}, function(data) {

										});
									}

								} ]);

		angular.bootstrap(document, [ 'zmxk' ]);
	</script>
</body>
</html>