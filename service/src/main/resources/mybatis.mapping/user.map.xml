<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="USER">
	<select id="listAll" resultType="com.smartool.common.dto.User">
		select * from users
	</select>
	<select id="search" parameterType="String" resultType="com.smartool.common.dto.User">
		select *
		from users where roleId=0 and mobileNum = #{id} or wcId = #{id}
	</select>
	<select id="getById" parameterType="String"
		resultType="com.smartool.common.dto.User">
		select * from users where id = #{id}
	</select>
	<select id="getByMobileNumber" parameterType="String"
		resultType="com.smartool.common.dto.User">
		select * from users where mobileNum = #{mobileNum}
	</select>
	
	<select id="getLoginUserByMobileNumber" parameterType="String"
		resultType="com.smartool.common.dto.LoginUser">
		select * from users where mobileNum = #{mobileNum}
	</select>

	<select id="getGrade" parameterType="String"
		resultType="com.smartool.common.dto.Grade">
		<![CDATA[select e.name as eventName, 
		et.name as eventTypeName, 
		et.siteId as siteId, 
		s.name as siteName, 
		e.eventTime as eventTime, 
		a.rank as rank, 
		ecr.credit as credit, 
		e.stage as stage, 
		e.seriesId as serieId, 
		u.name as userName, 
		u.id as userId, 
		k.name as kidName, 
		k.id as kidId 
		from attendees a, users u, sites s, events e, eventCreditRules ecr, eventTypes et, kids k 
		where k.userId = u.id and a.eventId=e.id and a.rank = ecr.rank
		and e.eventTypeId = et.id and et.siteId=s.id and u.id=a.userId and a.rank<=3 and  u.id = #{id}
		]]>
	</select>
	<select id="create" parameterType="com.smartool.common.dto.LoginUser">
		insert users (id, name,
		password,
		mobileNum, location,
		roleId,status,createdTime,
		lastModifiedTime)
		values
		(#{id},#{name},#{password},#{mobileNum},#{location},#{roleId},#{status},now(),now())
	</select>
	<select id="update" parameterType="com.smartool.common.dto.User">
		update users
		set
		name=#{name},
		password=#{password},
		mobileNum=#{mobileNum},
		location=#{location},
		roleId=#{roleId},
		status=#{status}, credit=#{credit}
		where id = #{id};
	</select>
	<select id="remove" parameterType="String">
		delete from users where id =
		#{id}
	</select>
	<update id="addCredit" parameterType="Map">
		update users
		set
		credit=credit+#{credit},goldenMedal=goldenMedal+#{goldenMedal},silverMedal=silverMedal+#{silverMedal},bronzeMedal=bronzeMedal+#{bronzeMedal}
		where id =
		#{id};
	</update>
</mapper>
