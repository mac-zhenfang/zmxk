<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="USER">
	<select id="listAll" resultType="com.smartool.common.dto.User">
		select * from users
	</select>
	<select id="search" parameterType="String" resultType="com.smartool.common.dto.User">
		select *
		from users where roleId=0 and mobileNum = #{id} or wcId = #{id}
	</select>
	<select id="getById" parameterType="String"
		resultType="com.smartool.common.dto.User">
		select * from users where id = #{id}
	</select>
	<select id="getByMobileNumber" parameterType="String"
		resultType="com.smartool.common.dto.User">
		select * from users where mobileNum = #{mobileNum}
	</select>

	<select id="getLoginUserByMobileNumber" parameterType="String"
		resultType="com.smartool.common.dto.LoginUser">
		select * from users where mobileNum = #{mobileNum}
	</select>

	<select id="getGrade" parameterType="String"
		resultType="com.smartool.common.dto.Grade">
		<![CDATA[select cr.rank as rank, e.eventTime as eventTime, u.name as userName, k.name as kidName, e.name as eventName, cr.credit as credit, cr.goldenMedal as goldenMedal, cr.silverMedal as silverMedal, cr.bronzeMedal as bronzeMedal from creditRecords cr, users u, kids k, events e, attendees a where k.userId=cr.userId and e.id=a.eventId and e.id=cr.eventId and cr.userId=u.id and cr.userId = #{id}
		]]>
	</select>
	<select id="create" parameterType="com.smartool.common.dto.LoginUser">
		insert users (id, name,
		password,
		mobileNum, location,
		roleId,status,siteId, createdTime,
		lastModifiedTime)
		values
		(#{id},#{name},#{password},#{mobileNum},#{location},#{roleId},#{status},#{siteId},now(),now())
	</select>
	<select id="update" parameterType="com.smartool.common.dto.User">
		update users
		set
		name=#{name},
		mobileNum=#{mobileNum},
		location=#{location},
		roleId=#{roleId},
		siteId=#{siteId},
		status=#{status}, credit=#{credit}
		where id = #{id};
	</select>
	<select id="remove" parameterType="String">
		delete from users where id =
		#{id}
	</select>
	<update id="addCredit" parameterType="Map">
		update users
		set
		credit=credit+#{credit},goldenMedal=goldenMedal+#{goldenMedal},silverMedal=silverMedal+#{silverMedal},bronzeMedal=bronzeMedal+#{bronzeMedal}
		where id =
		#{id};
	</update>
</mapper>
