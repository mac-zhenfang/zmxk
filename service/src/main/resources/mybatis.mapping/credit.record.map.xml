<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CREDIT_RECORD">
	<select id="create" parameterType="com.smartool.common.dto.CreditRecord">
		insert creditRecords (id,
		userId,eventId,
		creditRuleType,displayName,rank,creditRuleId,credit,goldenMedal,silverMedal,bronzeMedal,
		createdTime,
		lastModifiedTime)
		values
		(#{id},#{userId},#{eventId},#{creditRuleType},#{displayName},#{rank},#{creditRuleId},#{credit},#{goldenMedal},#{silverMedal},#{bronzeMedal},now(),now())
	</select>

	<select id="search" parameterType="Map"
		resultType="com.smartool.common.dto.CreditRecord">
		select r.id,
		userId,eventId,
		creditRuleType,displayName,rank,creditRuleId,r.credit,r.goldenMedal,r.silverMedal,r.bronzeMedal,
		r.createdTime,
		r.lastModifiedTime,mobileNum
		from creditRecords as r,
		users as u
		where u.id =
		r.userId
		<if test="userId != null">
			and r.userId = #{userId}
		</if>
		<if test="start != null">
			<![CDATA[and r.lastModifiedTime > #{start}]]>
		</if>
		<if test="end != null">
			<![CDATA[and r.lastModifiedTime < #{end}]]>
		</if>
		order by  r.lastModifiedTime desc
	</select>

	<select id="searchByMobileNumber" parameterType="Map"
		resultType="com.smartool.common.dto.CreditRecord">
		select r.id,
		userId,eventId,
		creditRuleType,displayName,rank,creditRuleId,r.credit,r.goldenMedal,r.silverMedal,r.bronzeMedal,
		r.createdTime,
		r.lastModifiedTime,mobileNum
		from creditRecords as r,
		users as u
		where u.id =
		r.userId
		<if test="mobileNum != null">
			and u.mobileNum = #{mobileNum}
		</if>
		<if test="start != null">
			<![CDATA[and r.lastModifiedTime > #{start}]]>
		</if>
		<if test="end != null">
			<![CDATA[and r.lastModifiedTime < #{end}]]>
		</if>
		order by  r.lastModifiedTime desc
	</select>

	<select id="getById" parameterType="String"
		resultType="com.smartool.common.dto.CreditRecord">
		select * from creditRecords where id = #{id}
	</select>
</mapper>
